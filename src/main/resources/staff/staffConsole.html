<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">

<head>
	<title>Staff Dashboard</title>
</head>

<body class="d-flex flex-column h-100">
	<div layout:fragment="content">
		<div th:if="${message != null}" class="alert alert-info" th:utext="${message}">message</div>
		<div th:if="${error != null}" class="alert alert-danger" th:utext="${error}">
			error</div>
		<main sec:authorize="hasAuthority('STAFF_PRIVILEGE')">
			<div class="container-fluid px-4">
				<h3 class="mt-4">Dashboard</h3>
				<ol class="breadcrumb mb-4">
					<li class="breadcrumb-item active">Staff Dashboard</li>
				</ol>
				<div class="row">
					<div class="col-xl-3 col-md-6">
						<div class="card bg-success text-white mb-4">
							<div class="card-body">Total Categories</div>
							<div class="card-footer d-flex align-items-center justify-content-between">
								<div class="counter-container">
									<div class="counter" th:attr="data-target=${totalCategoriesCount}"></div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-3 col-md-6">
						<div class="card bg-danger text-white mb-4">
							<div class="card-body">Total Sub Categories</div>
							<div class="card-footer d-flex align-items-center justify-content-between">
								<div class="counter-container">
									<div class="counter" th:attr="data-target=${totalSubCategoriesCount}"></div>
								</div>
							</div>
						</div>
					</div>
					
					<div class="col-xl-3 col-md-6">
						<div class="card bg-info text-white mb-4">
							<div class="card-body">My Total Created Posts</div>
							<div class="card-footer d-flex align-items-center justify-content-between">
								<div class="counter-container">
									<div class="counter" th:attr="data-target=${totalCreatedPostsCount}"></div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-3 col-md-6">
						<div class="card bg-primary text-white mb-4">
							<div class="card-body">My Total Published Posts</div>
							<div class="card-footer d-flex align-items-center justify-content-between">
								<div class="counter-container">
									<div class="counter" th:attr="data-target=${totalPublishedPostsCount}"></div>
								</div>
							</div>
						</div>
					</div>
					
					<div class="col-xl-3 col-md-6">
						<div class="card bg-warning text-white mb-4">
							<div class="card-body">Total Posts For Improvement</div>
							<div class="card-footer d-flex align-items-center justify-content-between">
								<div class="counter-container">
									<div class="counter" th:attr="data-target=${totalPostsForImprovementCount}"></div>
								</div>
							</div>
						</div>
					</div>

				</div>

				<div class="card mb-4">
					<div class="card-header">
						<i class="fas fa-table me-1"></i>
						Posts for Improvement
					</div>
					<div class="card-body">
						<table class="table table-striped table-bordered" id="improvementPostsTable" style="width: 100%;">
							<thead>
								<tr>
									<th scope="col" style="width: 10%;">Post Title</th>
									<th scope="col" style="width: 30%;">Description</th>
									<th scope="col" style="width: 10%;">Category</th>
									<th scope="col" style="width: 10%;">Status</th>
									<th scope="col" style="width: 10%;">Author</th>
									<th scope="col" style="width: 10%;">Create At</th>
									<th scope="col" style="width: 10%;">Edit</th>
									<th scope="col" style="width: 10%;">Preview</th>

								</tr>
							</thead>
							<tbody>
								<tr th:each="post : ${improvementposts}">
									<td th:text="${post.title}"></td>
									<td th:text="${post.description}" style="word-break: break-word !important;">
									</td>
									<td th:text="${post.subCategoryType.name}"></td>
									<td th:text="${post.status.getDisplayName()}"></td>
									<td th:text="${post.author.getUserDisplayName()}"></td>

									<td th:text="${#dates.format(post.createdAt, 'dd-MMM-yyyy')}"></td>
									<td><a th:href="@{/staff/post/edit/{id}(id=${post.id})}"
											class="btn btn-primary"><i class="fa-solid fa-pen-to-square"></i></a></td>
									<td><a th:href="@{/staff/previewPost/{postid}/{postname}(postid=${post.id},postname=${post.title})}"
											class="btn btn-primary"><i class="fa-solid fa-eye"></i></a></td>

								</tr>
							</tbody>
						</table>
					</div>
				</div>

			</div>
		</main>

		<script th:inline="javascript">

			const counters = document.querySelectorAll(".counter");

			counters.forEach((counter) => {
				counter.innerText = "0";
				const updateCounter = () => {
					const target = +counter.getAttribute("data-target");
					const count = +counter.innerText;
					const increment = target / 200;
					if (count < target) {
						counter.innerText = `${Math.ceil(count + increment)}`;
						setTimeout(updateCounter, 1);
					} else counter.innerText = target;
				};
				updateCounter();
			});

		</script>
		<script>
			$(document).ready(function () {
				$('#improvementPostsTable').dataTable({
					scrollY: 500,
					scrollX: true,
				});

			});

		</script>
	</div>

</body>

</html>