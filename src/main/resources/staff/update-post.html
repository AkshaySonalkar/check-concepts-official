<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5" layout:decorate="~{layout}">

<head>
	<title>Update Post</title>
</head>

<body class="d-flex flex-column h-100">
	<div layout:fragment="content">
		<div th:if="${message != null}" class="alert alert-info" th:utext="${message}">message</div>
		<div th:if="${error != null}" class="alert alert-danger" th:utext="${error}">
			error</div>
		<div class="container-fluid py-5">
			<section>
				<div class="card mb-4">
					<div class="card-header">
						<i class="fa-solid fa-images me-1"></i>
						Available Attachment
					</div>
					<div class="card-body">
						<table class="table table-striped table-bordered" id="attachmentsTable" style="width: 100%;">
							<thead>
								<tr>
									<th scope="col" style="width: 15%;">Attachment Name</th>
									<th scope="col" style="width: 15%;">Attachment Type</th>
									<th scope="col" style="width: 25%;">Attachment Source</th>
									<th scope="col" style="width: 15%;">View</th>
									<th scope="col" style="width: 15%;">Copy</th>
									<th scope="col" style="width: 15%;">Delete</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="att : ${post.postsAttachments}">
									<td th:text="${att.name}"></td>
									<td th:text="${att.attachmentType}">
									</td>
									<td th:text="${att.attachmentSrc}"></td>
									<td>
										<a type="button" class="fa-solid fa-eye text-decoration-none"
											data-bs-toggle="modal" data-bs-target="#pdfModalId"
											style="font-size: 1.5em;" th:if="${att.attachmentType == 'pdf'}"
											th:onclick="viewPdf([[${att.attachmentSrc}]],[[${att.name}]])">

										</a>
										<a type="button" class="fa-solid fa-eye text-decoration-none"
											data-bs-toggle="modal" data-bs-target="#imageModalId"
											style="font-size: 1.5em;" th:if="${att.attachmentType != 'pdf'}"
											th:onclick="viewImage([[${att.attachmentSrc}]],[[${att.name}]])">

										</a>
									</td>
									<td><a type="button" class="fa-solid fa-copy text-decoration-none"
											style="font-size: 1.5em;"
											th:onclick="copyImageUrl([[${att.attachmentSrc}]])">
										</a>
										<span th:id="${att.attachmentSrc}" style="display:none;"> copied! </span>
									</td>
									<td><a th:href="@{/staff/attachment/delete/{postid}/{attid}/{name}(postid=${post.id},attid=${att.id},name=${att.name})}"
											class="btn btn-primary"><i class="fa-solid fa-trash-can"></i>
									</td>

								</tr>
							</tbody>
						</table>
					</div>
				</div>

				<div class="card mb-4">
					<div class="card-header">
						<i class="fa-solid fa-images me-1"></i>
						Attachment Section
					</div>
					<div class="card-body">
						<div class="container h-100">

							<form action="#" method="POST" enctype="multipart/form-data"
								th:action="@{/staff/post/fileupload/{id}(id=${post.id})}">

								<div class="mb-3">
									<label for="file" class="form-label">File to upload for this post:</label>
									<input type="file" class="form-control" name="file" id="file" required
										accept="image/*,.pdf" />
								</div>
								<button type="submit" value="upload" class="btn btn-primary">Submit</button>
							</form>
						</div>
					</div>
				</div>
				<div class="card mb-4">
					<div class="card-header">
						<i class="fa-solid fa-pen-to-square me-1"></i>
						Edit Post
					</div>
					<div class="card-body">
						<div class="container h-100">

							<form action="#" th:action="@{/staff/update/post/{id}(id=${post.id})}" th:object="${post}"
								method="post">
								<div class="mb-3">
									<label for="categoryId" class="col-form-label">Category</label>
									<input type="text" th:field="*{subCategoryType.name}" class="form-control"
										id="categoryId" readonly>
									<span th:if="${#fields.hasErrors('subCategoryType.name')}"
										th:errors="*{subCategoryType.name}" class="text-danger"></span>
								</div>
								<div class="mb-3">
									<label for="name" class="col-form-label">Post Title</label>
									<input type="text" th:field="*{title}" class="form-control" id="title"
										placeholder="Title" required>
									<span th:if="${#fields.hasErrors('title')}" th:errors="*{title}"
										class="text-danger"></span>
								</div>
								<div class="mb-3">
									<label for="description" class="col-form-label">Post Description</label>
									<textarea type="text" th:field="*{description}" class="form-control md-textarea"
										id="description" placeholder="Description" required></textarea>
									<span th:if="${#fields.hasErrors('description')}" th:errors="*{description}"
										class="text-danger"></span>
								</div>

								<div class="mb-3">
									<label for="tagsId" class="form-label">Select Tags</label>

									<div class="container form-control" id="tagsId">
										<div class="row row-cols-auto">
											<div class="col" th:each="tag : ${alltags}"><input type="checkbox"
													th:id="${{tag}}" th:value="${{tag}}" th:field="*{tags}" />
												<label th:for="${{tag}}" th:text="${tag.name}">Tag</label>
											</div>
										</div>
									</div>
								</div>

								<div class="mb-3">
									<label for="postcontent" class="col-form-label">Post Content</label>
									<textarea type="text" th:field="*{content}" class="form-control md-textarea"
										id="postcontent" placeholder="Content" required></textarea>
									<span th:if="${#fields.hasErrors('content')}" th:errors="*{content}"
										class="text-danger"></span>
								</div>

								<input type="submit" class="btn btn-primary" value="Update Post">
							</form>
						</div>
					</div>
				</div>
			</section>
		</div>




		<!-- Modal -->
		<div class="modal fade" id="imageModalId" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
			aria-labelledby="staticBackdropLabel" aria-hidden="true">
			<div class="modal-dialog modal-fullscreen">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="staticBackdropLabel">Image Viewer</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<img id="displayImageId" />
						</iframe>
					</div>
				</div>
			</div>
		</div>

		<div class="modal fade" id="pdfModalId" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
			aria-labelledby="staticBackdropLabel" aria-hidden="true">
			<div class="modal-dialog modal-fullscreen">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="staticBackdropLabel">PDF Viewer</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<iframe id="pdfViewerId" width="100%" height="100%" allowfullscreen>
						</iframe>
					</div>
				</div>
			</div>
		</div>

		<script type="text/javascript">
			$(document).ready(function () {

				$('#attachmentsTable').dataTable({
					scrollY: 200,
					scrollX: true,
				});

				$('#postcontent').richText();

			});

			function copyImageUrl(imageUrl) {
				navigator.clipboard.writeText(imageUrl);
				document.getElementById(imageUrl).style.display = "inline-block";

				setTimeout(function () {
					document.getElementById(imageUrl).style.display = "none";
				}, 1000);
			}

			function viewImage(url, name) {
				var att = document.getElementById('displayImageId');
				att.src = url;
				att.title = name;
				att.alt = name;
			}

			function viewPdf(url, name) {
				var att = document.getElementById('pdfViewerId');
				att.src = url;
				att.title = name;
			}

		</script>
	</div>
</body>

</html>